# `BottEvent` Structure

For this `Task` you will be working with `BottEvent`s. A `BottEvent` is the core data structure for all interactions within the system. It represents everything from user messages to system actions.

## Common Properties

All `BottEvent` objects share the following base properties:

```json
{
  "id": "string",
  "type": "string",
  "createdAt": "a_few_seconds_ago",
  "user": {
    "id": "string",
    "name": "string"
  }
}
```


| Property    | Type     | Description                                                                            |
| ----------- | -------- | -------------------------------------------------------------------------------------- |
| `id`        | `string` | A unique identifier for the event.                                                     |
| `type`      | `string` | The type of event. See `Type-Based Properties` for more details.                       |
| `createdAt` | `string` | A relative time string (e.g., "a few seconds ago") indicating when the event occurred. |
| `user`      | `object` | The user who initiated the event. For system events, this is _your_ user identity.     |

### Attached Files

Each `BottEvent` object may have one or more attached files. These are not a part of the JSON object, but rather 
added by the system under a `--- Attached Files ---` header.

There may be files referenced in events that are missing - they were likely pruned by the system to fit into context.

##  Type-Based Properties

Then, there are a couple additional properties whose presence and shape depend on the `type` of `BottEvent`.

| Property    | Type     | Description                                              |
| ----------- | -------- | -------------------------------------------------------- |
| `parent`    | `object` | A pointer to a relevant parent event.                    |
| `details`   | `object` | An object containing the application data for the event. |

Let's break down each `BottEvent` `type` and how their type-based properties are structured:

### `message`

A standalone message. These events can be provided by a user or generated by the system.

- **Required Properties**:
  - `details.content`: `string` - The text content of the message.
- **Generated Properties**:
  - `details.scores`: `object` - An object containing content ratings across several dimensions. For incoming messages, these are the `Focus Classifiers`. For outgoing messages, these are the `Filter Classifiers`.
  - `details.focus`: `boolean` - _For user-provided messages_ - whether or not, based on the `scores`, to focus on handling this event.
  - `details.output`: `boolean` - _For system-generated messages_ - whether or not, based on the `scores`, to output this event.

### `reply`

A direct reply to a previous event. These events can be provided by a user or generated by the system.

- **Required Properties**:
  - `parent`: `object` - A reference to the event being replied to. Must contain an `id`.
  - `details.content`: `string` - The text content of the reply.
- **Generated Properties**:
  - `details.scores`: `object` - An object containing content ratings across several dimensions. For incoming messages, these are the `Focus Classifiers`. For outgoing messages, these are the `Filter Classifiers`.
  - `details.focus`: `boolean` - _For user-provided messages_ - whether or not, based on the `scores`, to focus on handling this event.
  - `details.output`: `boolean` - _For system-generated messages_ - whether or not, based on the `scores`, to output this event.

### `reaction`

An emoji reaction to a previous event. These events can be provided by a user or generated by the system.

- **Required Properties**:
  - `parent`: `object` - A reference to the event being reacted to. Must contain an `id`.
  - `details.content`: `string` - The emoji character.
- **Generated Properties**:
  - `details.focus`: `boolean` - _For user-provided messages_ - For `reaction` events, this is always `false`.
  - `details.output`: `boolean` - _For system-generated messages_ - whether or not, based on the `scores`, to output this event.

### `actionCall`

A system instruction to execute an asynchronous task. These events can only be generated by the system.

- **Required Properties**:
  - `details.name`: `string` - The name of the action to execute.
  - `details.options`: `object` - The parameters for the action.
- **Generated Properties**:
  - `details.scores`: `object` - An object containing content ratings across several dimensions. As this is a system-only type, these are always the `Filter Classifiers`.
  - `details.output`: `boolean` - whether or not, based on the `scores`, to output this event.

---

## `details.scores` Breakdown

The `details.scores` object contains either 

### Focus Classifiers

<% for (const reason of settings.reasons.input) { %>
  <% for (const classifier of reason.classifiers ?? []) { %>
#### <%= classifier.name %>
  <% for (const key of Object.keys(classifier.examples)) { %>
- **Examples of a score of `<%= key %>`**:
    <% for (const example of classifier.examples[key]) { %>
  - <%= example %>
    <% } %>
  <% } %>
  <% } %>
<% } %>

### Output Classifiers

<% for (const reason of settings.reasons.output) { %>
  <% for (const classifier of reason.classifiers ?? []) { %>
#### <%= classifier.name %>
**Definition**: <%= classifier.definition %>
  <% for (const key of Object.keys(classifier.examples)) { %>
- **Examples of a score of `<%= key %>`**:
    <% for (const example of classifier.examples[key]) { %>
  - <%= example %>
    <% } %>
  <% } %>
  <% } %>
<% } %>

## `details.name` & `details.options` Breakdown

In a `BottEvent` of `type: "actionCall"`, the `details.name` and `details.options` properties define which system action to run and with what parameters. These are the actions currently available to the system:

<% for (const action of Object.values(actions)) { %>
##### Action: `<%= action.name %>`

<%= action.description %>

| Option          | Description | Type            | Allowed Values                                                                                                                            | Required |
| --------------- | ----------- | --------------- | ----------------------------------------------------------------------------------------------------------------------------------------- | -------- |
<% for (const option of Object.values(action.options ?? {})) { %>
| `<%= option.name %>` | <%= option.description ?? '-' %> | `<%= option.type %>` | <% if (!option.allowedValues || option.allowedValues.length === 0) { %>*any*<% } else { %><% for (const [i, value] of option.allowedValues.entries()) { %>`<%= value %>`<%= i < option.allowedValues.length - 1 ? ', ' : '' %><% } %><% } %> | <%= option.required ? 'Yes' : 'No' %> |
<% } %>
<% } %>

---

## Example `BottEvent` Payloads

### `message`
```json
{
  "id": "msg_1a2b3c",
  "type": "message",
  "timestamp": "a few seconds ago",
  "user": {
    "id": "user_xyz",
    "name": "John Doe"
  },
  "details": {
    "content": "Hello, world!",
    "scores": {
      "some_focus_classifier_name": "4"
    },
    "focus": true
  }
}
```

### `reply`
```json
{
  "id": "rply_4d5e6f",
  "type": "reply",
  "parent": {
    "id": "msg_1a2b3c"
  },
  "timestamp": "a minute ago",
  "user": {
    "id": "user_abc",
    "name": "Jane Smith"
  },
  "details": {
    "content": "Hello back!",
    "scores": {
      "some_focus_classifier_name": "2"
    },
    "focus": false
  }
}
```

### `reaction`
```json
{
  "id": "react_7g8h9i",
  "type": "reaction",
  "parent": {
    "id": "msg_1a2b3c"
  },
  "timestamp": "2 minutes ago",
  "user": {
    "id": "user_abc",
    "name": "Jane Smith"
  },
  "details": {
    "content": "üëç",
    "focus": false
  }
}
```

### `actionCall`
```json
{
  "id": "act_j1k2l3",
  "type": "actionCall",
  "timestamp": "3 minutes ago",
  "user": {
    "id": "<%= user.id %>",
    "name": "<%= user.name %>"
  },
  "details": {
    "name": "generateMedia",
    "options": {
      "prompt": "A futuristic cityscape at sunset",
      "type": "image"
    },
    "filter": false,
    "scores": {
      "some_filter_classifier_name": "4"
    }
  }
}
```
