#!/usr/bin/env bash
# @license
# This file is part of Bott.
#
# This project is dual-licensed:
# - Non-commercial use: AGPLv3 (see LICENSE file for full text).
# - Commercial use: Proprietary License (contact D@nielLaCos.se for details).
#
# Copyright (C) 2025 DanielLaCos.se

set -euo pipefail

# Get script directory and source utilities
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
source "$SCRIPT_DIR/utils/log.sh"
source "$SCRIPT_DIR/utils/checks.sh"

# Default values
ENV="${ENV:-production}"
GCP_SERVICE_NAME="${GCP_SERVICE_NAME:-bott-$ENV}"
LIMIT="${LIMIT:-50}"

# Main execution
main() {
  check_gcloud
  
  info_log "Fetching logs for service: $GCP_SERVICE_NAME (limit: $LIMIT)"
  
  gcloud logging read \
    "resource.type=cloud_run_revision AND resource.labels.service_name=$GCP_SERVICE_NAME" \
    --limit "$LIMIT" \
    --format="table(timestamp,severity,textPayload)"
}

# Run main function
main "$@"
