#!/usr/bin/env bash
# @license
# This file is part of Bott.
#
# This project is dual-licensed:
# - Non-commercial use: AGPLv3 (see LICENSE file for full text).
# - Commercial use: Proprietary License (contact D@nielLaCos.se for details).
#
# Copyright (C) 2025 DanielLaCos.se

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
source "$SCRIPT_DIR/common/logger.sh"

ENV="${ENV:-production}"
ENV_FILE="${ENV_FILE:-.env.$ENV.yml}"

GCP_SERVICE_NAME="${GCP_SERVICE_NAME:-bott-$ENV}"
GCP_REGION="${GCP_REGION:-us-central1}"

main() {
  if [ -f "$ENV_FILE" ]; then
    source "$ENV_FILE"
  fi
  
  local project_id="${GCP_PROJECT_ID:-$(gcloud config get-value project 2>/dev/null)}"

  if [ -z "$project_id" ]; then
    error_log "GCP Project ID not found. Please set GCP_PROJECT_ID or configure gcloud."
    exit 1
  fi
  
  gcloud beta run services logs tail "$GCP_SERVICE_NAME" \
    --project "$project_id" \
    --region "$GCP_REGION"
}

main "$@"
